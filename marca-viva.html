<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Marca Viva ‚Äì Formul√°rio de Desafios no Instagram</title>
  <meta name="description" content="Conte seu maior desafio no Instagram e receba uma resposta personalizada da Marca Viva." />

  <!-- Aplica tema salvo/sistema antes de renderizar para evitar flash -->
  <script>
    (function(){
      try {
        const ls = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (ls === 'dark' || (!ls && prefersDark)) {
          document.documentElement.classList.add('dark');
        }
      } catch (_) {}
    })();
  </script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class', // importante para o toggle funcionar
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#eef9ff',
              100: '#d9f0ff',
              200: '#afe0ff',
              300: '#7ccaff',
              400: '#46b1ff',
              500: '#1f97ff', // prim√°ria
              600: '#0a77db',
              700: '#085bb0',
              800: '#0a487f',
              900: '#0b3c66'
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Remove setinhas do input number no Chrome */
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-white to-slate-50 text-slate-900 dark:from-slate-950 dark:to-slate-900 dark:text-slate-100">
  <header class="max-w-3xl mx-auto px-4 pt-10 pb-4">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="size-10 rounded-2xl bg-brand-500/10 text-brand-600 dark:text-brand-300 grid place-items-center">
          <span class="text-xl font-semibold">MV</span>
        </div>
        <div>
          <h1 class="text-2xl font-semibold tracking-tight">Marca Viva</h1>
          <p class="text-sm text-slate-500 dark:text-slate-400">Viva a sua marca no Instagram</p>
        </div>
      </div>
      <button id="themeToggle" type="button" class="inline-flex items-center gap-2 rounded-xl border border-slate-200 dark:border-slate-700 px-3 py-2 text-sm font-medium hover:bg-slate-50 dark:hover:bg-slate-800 active:scale-[.98] transition shadow-sm focus:outline-none focus:ring-4 focus:ring-brand-500/20">
        <span id="themeIcon" aria-hidden>üåô</span>
        <span>Modo</span>
      </button>
    </div>
  </header>

  <main class="max-w-3xl mx-auto px-4 pb-16">
    <section class="rounded-3xl border border-slate-200/70 dark:border-slate-800 bg-white/70 dark:bg-slate-900/70 backdrop-blur p-6 md:p-8 shadow-sm">
      <div class="mb-6">
        <h2 class="text-xl md:text-2xl font-semibold leading-tight">Conte seu maior desafio no Instagram</h2>
        <p class="mt-2 text-slate-600 dark:text-slate-400">Preencha o formul√°rio abaixo. No final, clique em <strong>Enviar no WhatsApp</strong> e sua mensagem chega pronta para a equipe da Marca Viva.</p>
      </div>

      <form id="mv-form" class="grid gap-5">
        <!-- Identifica√ß√£o -->
        <div class="grid md:grid-cols-2 gap-5">
          <div>
            <label class="block text-sm font-medium mb-1" for="nome">Seu nome *</label>
            <input id="nome" name="nome" type="text" required
                   class="w-full rounded-2xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-4 py-3 outline-none focus:ring-4 focus:ring-brand-500/20 focus:border-brand-500" placeholder="Ex.: Ana Souza" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1" for="instagram">@ no Instagram</label>
            <input id="instagram" name="instagram" type="text"
                   class="w-full rounded-2xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-4 py-3 outline-none focus:ring-4 focus:ring-brand-500/20 focus:border-brand-500" placeholder="Ex.: @minhamarca" />
          </div>
        </div>

        <!-- Perfil -->
        <div class="grid md:grid-cols-2 gap-5">
          <div>
            <label class="block text-sm font-medium mb-1" for="perfil">Voc√™ √© *</label>
            <select id="perfil" name="perfil" required class="w-full rounded-2xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-4 py-3 outline-none focus:ring-4 focus:ring-brand-500/20 focus:border-brand-500">
              <option value="">Selecione...</option>
              <option>Aut√¥nomo(a)</option>
              <option>MEI</option>
              <option>Pequena empresa</option>
              <option>Prestador(a) de servi√ßo</option>
              <option>Criador(a) de conte√∫do</option>
              <option>Outra</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1" for="nicho">Nicho / √°rea</label>
            <input id="nicho" name="nicho" type="text" class="w-full rounded-2xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-4 py-3 outline-none focus:ring-4 focus:ring-brand-500/20 focus:border-brand-500" placeholder="Ex.: est√©tica, alimentos, moda..." />
          </div>
        </div>

        <!-- Desafio principal -->
        <div>
          <label class="block text-sm font-medium mb-1" for="desafio">Seu principal desafio no Instagram *</label>
          <select id="desafio" name="desafio" required class="w-full rounded-2xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-4 py-3 outline-none focus:ring-4 focus:ring-brand-500/20 focus:border-brand-500">
            <option value="">Selecione...</option>
            <option>Falta de consist√™ncia para postar</option>
            <option>Ideias de conte√∫do (o que postar)</option>
            <option>Baixo alcance e crescimento</option>
            <option>Pouco engajamento (coment√°rios/salvos)</option>
            <option>Transformar visualiza√ß√µes em vendas</option>
            <option>Tr√°fego do Instagram para o WhatsApp</option>
            <option>Edi√ß√£o/qualidade dos v√≠deos</option>
            <option>Medo/vergonha de aparecer</option>
            <option>Outro</option>
          </select>
        </div>
        <div id="desafioOutroWrap" class="hidden">
          <label class="block text-sm font-medium mb-1" for="desafioOutro">Qual?</label>
          <input id="desafioOutro" name="desafioOutro" type="text" class="w-full rounded-2xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-4 py-3 outline-none focus:ring-4 focus:ring-brand-500/20 focus:border-brand-500" placeholder="Descreva seu desafio" />
        </div>

        <!-- Texto livre -->
        <div>
          <label class="block text-sm font-medium mb-1" for="travando">Explique com suas palavras o que est√° te travando *</label>
          <textarea id="travando" name="travando" rows="4" required class="w-full rounded-2xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-4 py-3 outline-none focus:ring-4 focus:ring-brand-500/20 focus:border-brand-500" placeholder="Me conte o cen√°rio, o que j√° tentou, onde complica..."></textarea>
        </div>

        <!-- Objetivo -->
        <div>
          <label class="block text-sm font-medium mb-1" for="objetivo">Seu objetivo para os pr√≥ximos 30 dias</label>
          <textarea id="objetivo" name="objetivo" rows="3" class="w-full rounded-2xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 px-4 py-3 outline-none focus:ring-4 focus:ring-brand-500/20 focus:border-brand-500" placeholder="Ex.: postar 3x/semana, vender 10 servi√ßos, bater 1.000 seguidores..."></textarea>
        </div>

        <!-- Estrat√©gias j√° testadas -->
        <fieldset class="grid gap-3">
          <legend class="text-sm font-medium">O que voc√™ j√° tentou? (opcional)</legend>
          <div class="grid md:grid-cols-2 gap-3">
            <label class="flex items-center gap-3">
              <input type="checkbox" value="Calend√°rio editorial" class="size-5 rounded accent-brand-500" />
              <span>Calend√°rio editorial</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" value="Reels com ganchos fortes" class="size-5 rounded accent-brand-500" />
              <span>Reels com ganchos fortes</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" value="Parcerias/colabs" class="size-5 rounded accent-brand-500" />
              <span>Parcerias/colabs</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" value="An√∫ncios pagos" class="size-5 rounded accent-brand-500" />
              <span>An√∫ncios pagos</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" value="CTA para WhatsApp" class="size-5 rounded accent-brand-500" />
              <span>CTA para WhatsApp</span>
            </label>
            <label class="flex items-center gap-3">
              <input type="checkbox" value="Nada ainda" class="size-5 rounded accent-brand-500" />
              <span>Nada ainda</span>
            </label>
          </div>
        </fieldset>

        <!-- Consentimentos -->
        <div class="grid md:grid-cols-2 gap-5">
          <label class="flex items-center gap-3">
            <input id="contato" type="checkbox" class="size-5 rounded accent-brand-500" />
            <span>Quero receber sugest√µes personalizadas pelo WhatsApp</span>
          </label>
          <label class="flex items-center gap-3">
            <input id="material" type="checkbox" class="size-5 rounded accent-brand-500" />
            <span>Topa receber materiais gr√°tis (Marca Viva, Finanza e GuiaBM)</span>
          </label>
        </div>

        <!-- A√ß√µes -->
        <div class="flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between pt-2">
          <div class="text-xs text-slate-500 dark:text-slate-400">Ao enviar, abriremos seu WhatsApp com a mensagem j√° pronta. Voc√™ poder√° editar antes de enviar.</div>
          <div class="flex gap-3">
            <button id="copyBtn" type="button" class="rounded-2xl px-5 py-3 border border-slate-300 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition focus:outline-none focus:ring-4 focus:ring-brand-500/20">Copiar mensagem</button>
            <button id="sendBtn" type="submit" class="rounded-2xl px-5 py-3 bg-brand-500 text-white font-semibold shadow-[0_6px_20px_rgba(31,151,255,0.35)] hover:brightness-110 active:scale-[.98] transition focus:outline-none focus:ring-4 focus:ring-brand-500/30">Enviar no WhatsApp</button>
          </div>
        </div>

        <p id="feedback" class="hidden text-sm"></p>
      </form>

      <div class="mt-8 border-t border-slate-200 dark:border-slate-800 pt-6 text-sm text-slate-600 dark:text-slate-400">
        <p>Projetos parceiros: <a class="text-brand-600 hover:underline" href="https://appfinanza.com.br/" target="_blank" rel="noopener">Finanza</a> e <a class="text-brand-600 hover:underline" href="https://guiabm.com.br/" target="_blank" rel="noopener">GuiaBM</a>.</p>
      </div>
    </section>
  </main>

  <script>
    // Config ‚Äì ajuste o n√∫mero do destino WhatsApp aqui (incluir DDI + DDD, s√≥ d√≠gitos)
    const DESTINO_WHATSAPP = '5512991599185'; // +55 12 99159-9185

    // Altern√¢ncia de tema
    const themeBtn = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    function setIcon() {
      const dark = document.documentElement.classList.contains('dark');
      themeIcon.textContent = dark ? '‚òÄÔ∏è' : 'üåô';
    }
    setIcon();

    themeBtn.addEventListener('click', () => {
      const html = document.documentElement;
      const turnedDark = html.classList.toggle('dark');
      localStorage.setItem('theme', turnedDark ? 'dark' : 'light');
      setIcon();
    });

    // Campo condicional "Outro"
    const desafioSel = document.getElementById('desafio');
    const outroWrap = document.getElementById('desafioOutroWrap');
    desafioSel.addEventListener('change', () => {
      outroWrap.classList.toggle('hidden', desafioSel.value !== 'Outro');
    });

    // Monta a mensagem final
    function montarMensagem() {
      const nome = document.getElementById('nome').value.trim();
      const insta = document.getElementById('instagram').value.trim();
      const perfil = document.getElementById('perfil').value.trim();
      const nicho = document.getElementById('nicho').value.trim();
      const desafio = document.getElementById('desafio').value;
      const desafioOutro = document.getElementById('desafioOutro').value.trim();
      const travando = document.getElementById('travando').value.trim();
      const objetivo = document.getElementById('objetivo').value.trim();
      const contato = document.getElementById('contato').checked ? 'Sim' : 'N√£o';
      const material = document.getElementById('material').checked ? 'Sim' : 'N√£o';

      const tentativas = Array.from(document.querySelectorAll('fieldset input[type="checkbox"]:checked'))
        .map(c => c.value)
        .join(', ');

      const desafioFinal = desafio === 'Outro' && desafioOutro ? desafioOutro : desafio;

      const linhas = [
        'Ol√°, equipe Marca Viva! üëã',
        'Quero compartilhar meu desafio no Instagram:',
        '',
        `‚Ä¢ Nome: ${nome || '‚Äî'}`,
        `‚Ä¢ Instagram: ${insta || '‚Äî'}`,
        `‚Ä¢ Perfil: ${perfil || '‚Äî'}`,
        `‚Ä¢ Nicho/√Årea: ${nicho || '‚Äî'}`,
        `‚Ä¢ Desafio principal: ${desafioFinal || '‚Äî'}`,
        `‚Ä¢ O que est√° me travando: ${travando || '‚Äî'}`,
        `‚Ä¢ Objetivo (30 dias): ${objetivo || '‚Äî'}`,
        `‚Ä¢ O que j√° tentei: ${tentativas || '‚Äî'}`,
        `‚Ä¢ Posso receber sugest√µes por WhatsApp? ${contato}`,
        `‚Ä¢ Aceito materiais gr√°tis (Marca Viva, Finanza, GuiaBM)? ${material}`,
        '',
        '‚Äî Enviado pelo formul√°rio do projeto Marca Viva.'
      ];

      // FIX: juntar com quebra de linha correta ("\n")
      return linhas.join('\n');
    }

    // Copiar mensagem para a √°rea de transfer√™ncia
    document.getElementById('copyBtn').addEventListener('click', async () => {
      const msg = montarMensagem();
      try {
        await navigator.clipboard.writeText(msg);
        mostrarFeedback('Mensagem copiada. Agora √© s√≥ colar no WhatsApp ‚úÖ');
      } catch {
        mostrarFeedback('N√£o foi poss√≠vel copiar automaticamente. Se preferir, envie pelo bot√£o WhatsApp.', true);
      }
    });

    // Enviar no WhatsApp
    document.getElementById('mv-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const form = e.currentTarget;
      if (!form.reportValidity()) return;
      const msg = montarMensagem();
      const encoded = encodeURIComponent(msg);
      const urlWeb = `https://wa.me/${DESTINO_WHATSAPP}?text=${encoded}`;
      const urlApi = `https://api.whatsapp.com/send?phone=${DESTINO_WHATSAPP}&text=${encoded}`;

      const novaAba = window.open(urlWeb, '_blank');
      if (!novaAba || novaAba.closed || typeof novaAba.closed === 'undefined') {
        // Pop-up bloqueado ou falha: tenta API URL
        window.location.href = urlApi;
      } else {
        mostrarFeedback('Abrimos seu WhatsApp com a mensagem pronta. Voc√™ pode editar antes de enviar. ‚úÖ');
      }
    });

    function mostrarFeedback(texto, isWarn = false) {
      const el = document.getElementById('feedback');
      el.textContent = texto;
      el.className = `mt-2 ${isWarn ? 'text-amber-600 dark:text-amber-400' : 'text-emerald-600 dark:text-emerald-400'} block`;
    }

    // =============================
    // TESTES (n√£o alteram o uso normal)
    // =============================
    document.addEventListener('DOMContentLoaded', () => {
      try {
        console.assert(typeof montarMensagem === 'function', 'Teste: montarMensagem deve existir');

        // Teste 1: join com \n funciona
        const j = ['a','b'].join('\n');
        console.assert(j === 'a\nb', 'Teste: join com quebra de linha deve resultar em "a\\nb"');

        // Teste 2: mensagem cont√©m quebras de linha e bullets
        const form = document.getElementById('mv-form');
        const backup = {
          nome: document.getElementById('nome').value,
          instagram: document.getElementById('instagram').value,
          perfil: document.getElementById('perfil').value,
          nicho: document.getElementById('nicho').value,
          desafio: document.getElementById('desafio').value,
          desafioOutro: document.getElementById('desafioOutro').value,
          travando: document.getElementById('travando').value,
          objetivo: document.getElementById('objetivo').value,
        };
        // Preenche valores tempor√°rios
        document.getElementById('nome').value = 'Teste Usu√°rio';
        document.getElementById('instagram').value = '@teste';
        document.getElementById('perfil').value = 'MEI';
        document.getElementById('nicho').value = 'est√©tica';
        document.getElementById('desafio').value = 'Baixo alcance e crescimento';
        document.getElementById('travando').value = 'Sem const√¢ncia';
        document.getElementById('objetivo').value = 'Postar 3x/semana';

        const msg = montarMensagem();
        console.assert(/\n‚Ä¢ Instagram:/.test(msg), 'Teste: mensagem deve conter quebra de linha antes de "‚Ä¢ Instagram"');
        console.assert(msg.includes('‚Äî Enviado pelo formul√°rio do projeto Marca Viva.'), 'Teste: mensagem deve encerrar com assinatura');

        // Restaura (limpa, pois iniciou vazio)
        form.reset();

        console.log('%cTodos os testes passaram ‚úÖ', 'padding:4px 8px;border-radius:6px;background:#16a34a;color:white');
      } catch (err) {
        console.error('Falha nos testes:', err);
      }
    });
  </script>
</body>
</html>
